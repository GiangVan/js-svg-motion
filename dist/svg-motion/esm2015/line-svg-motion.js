export class LineSvgMotion {
    constructor() {
        this.lineAnimations = [];
    }
    getLineAnimations() {
        return this.lineAnimations;
    }
    drawLineGroupToVolume(dAttribute, element, volume, reverse = false) {
        const pointGroups = this.generatePointGroups(dAttribute);
        for (let i = 0; i < pointGroups.length; i++) {
            if (reverse) {
                pointGroups[i] = pointGroups[i].reverse();
            }
            dAttribute = this.drawLineToVolume(pointGroups[i], i + 1, dAttribute, element, volume);
        }
        return dAttribute;
    }
    animateLineGroup(dAttribute, element, { time: time = 1000, step: step = 100, isReversed: isReversed = false, mode: mode = 'EXPAND' }, finishCallback = null) {
        mode = mode.toUpperCase();
        const lineAnimationId = this.pushNewLineAnimation();
        switch (mode) {
            case 'COLLAPSE':
                this.handleAnimationCollapseMode(lineAnimationId, dAttribute, element, step, time, isReversed, finishCallback);
                break;
            case 'LOADING':
                this.handleAnimationLoadingMode(lineAnimationId, dAttribute, element, step, time, isReversed);
                break;
            case 'LOADING2':
                this.handleAnimationLoading2Mode(lineAnimationId, dAttribute, element, step, time, isReversed);
                break;
            case 'LOADING3':
                this.handleAnimationLoading3Mode(lineAnimationId, dAttribute, element, step, time, isReversed);
                break;
            case 'LOADING4':
                this.handleAnimationLoading4Mode(lineAnimationId, dAttribute, element, step, time, isReversed);
                break;
            default:
                this.handleAnimationNormalMode(lineAnimationId, dAttribute, element, step, time, isReversed, finishCallback);
                break;
        }
        return lineAnimationId;
    }
    calcMotionTrigonometricEquations(x) {
        return Math.sin((Math.PI / 2) * Math.pow(x, 6));
    }
    generateLineAnimationId() {
        return Symbol();
    }
    removeLineAnimation(id) {
        const index = this.lineAnimations.indexOf(id);
        if (index !== -1) {
            this.lineAnimations.splice(index, 1);
        }
    }
    existLineAnimation(id) {
        return this.lineAnimations.indexOf(id) !== -1;
    }
    pushNewLineAnimation() {
        const key = this.generateLineAnimationId();
        this.lineAnimations.push(key);
        return key;
    }
    handleAnimationLoadingMode(animationId, dAttribute, element, step, time, isReversed) {
        const speed = time / step;
        this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 0, true, isReversed, () => {
            this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 100, false, !isReversed, () => {
                this.handleAnimationLoadingMode(animationId, dAttribute, element, step, time, isReversed);
            });
        });
    }
    handleAnimationLoading2Mode(animationId, dAttribute, element, step, time, isReversed) {
        const speed = time / step;
        this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 0, true, isReversed, () => {
            this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 100, false, isReversed, () => {
                this.handleAnimationLoading2Mode(animationId, dAttribute, element, step, time, isReversed);
            });
        });
    }
    handleAnimationLoading3Mode(animationId, dAttribute, element, step, time, isReversed) {
        const speed = time / step;
        this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 100, false, !isReversed, () => {
            this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 0, true, isReversed, () => {
                this.handleAnimationLoading3Mode(animationId, dAttribute, element, step, time, isReversed);
            });
        });
    }
    handleAnimationLoading4Mode(animationId, dAttribute, element, step, time, isReversed) {
        const speed = time / step;
        this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 100, false, isReversed, () => {
            this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, 0, true, !isReversed, () => {
                this.handleAnimationLoading4Mode(animationId, dAttribute, element, step, time, isReversed);
            });
        });
    }
    handleAnimationCollapseMode(animationId, dAttribute, element, step, time, isReversed, finishCallback) {
        this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, (time / step), 100, false, isReversed, finishCallback);
    }
    handleAnimationNormalMode(animationId, dAttribute, element, step, time, isReversed, finishCallback) {
        this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, (time / step), 0, true, isReversed, finishCallback);
    }
    recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, currentStep, isExpand, isReversed, finishCallback) {
        if (this.existLineAnimation(animationId)) {
            this.drawLineGroupToVolume(dAttribute, element, 100 * this.calcMotionTrigonometricEquations(currentStep / step), isReversed);
            if ((isExpand && currentStep === step) ||
                (!isExpand && currentStep === 0)) {
                if (finishCallback != null) {
                    finishCallback();
                }
            }
            else {
                if (isExpand) {
                    currentStep++;
                }
                else {
                    currentStep--;
                }
                setTimeout(() => (this.recursiveAnimationLineGroup(animationId, dAttribute, element, step, speed, currentStep, isExpand, isReversed, finishCallback)), speed);
            }
        }
    }
    generatePointGroups(dAttribute) {
        const pointGroupStrings = dAttribute.split("M");
        const pointGroups = [];
        if (pointGroupStrings[0] === "") {
            for (let i = 1; i < pointGroupStrings.length; i++) {
                const pointStrings = pointGroupStrings[i].split("L");
                for (let j = 0; j < pointStrings.length; j++) {
                    const point = [
                        parseFloat(pointStrings[j].split(",")[0]),
                        parseFloat(pointStrings[j].split(",")[1]),
                    ];
                    if (pointGroups[i - 1] === undefined) {
                        pointGroups[i - 1] = [];
                    }
                    pointGroups[i - 1][pointGroups[i - 1].length] = point;
                }
            }
        }
        else {
            alert("not found M");
        }
        return pointGroups.length > 0 ? pointGroups : null;
    }
    countOccurrences(text, search) {
        return text.split(search).length - 1;
    }
    getRangeOf(text, search, no) {
        if (this.countOccurrences(text, search) >= no) {
            let startIndex = 0;
            let endIndex = 0;
            let n = 0;
            while (n < no) {
                startIndex = text.indexOf(search, startIndex) + search.length;
                n++;
            }
            endIndex = (text.indexOf(search, startIndex) === -1) ? text.length : text.indexOf(search, startIndex);
            return [
                startIndex,
                endIndex
            ];
        }
        else {
            return null;
        }
    }
    getPointsDistance(point1, point2) {
        return Math.sqrt(Math.pow(point2[0] - point1[0], 2) + Math.pow(point2[1] - point1[1], 2));
    }
    getLineLength(pointGroup) {
        let length = 0.0;
        for (let i = 1; i < pointGroup.length; i++) {
            length += this.getPointsDistance(pointGroup[i - 1], pointGroup[i]);
        }
        return length;
    }
    roundPoint(point) {
        point[0] = Math.round((point[0] + Number.EPSILON) * 1000) / 1000;
        point[1] = Math.round((point[1] + Number.EPSILON) * 1000) / 1000;
        return point;
    }
    changePointGroupAtLength(pointGroup, length) {
        let currentLength = 0;
        const newPointGroup = [pointGroup[0]];
        for (let i = 1; i < pointGroup.length; i++) {
            const currentLineLength = this.getPointsDistance(pointGroup[i - 1], pointGroup[i]);
            currentLength += currentLineLength;
            newPointGroup.push(pointGroup[i]);
            if (currentLength >= length) {
                const newLineLength = length + currentLineLength - currentLength;
                const betweenLengthRatio = newLineLength / currentLineLength;
                newPointGroup[i] = this.roundPoint([
                    pointGroup[i - 1][0] + ((pointGroup[i][0] - pointGroup[i - 1][0]) * betweenLengthRatio),
                    pointGroup[i - 1][1] + ((pointGroup[i][1] - pointGroup[i - 1][1]) * betweenLengthRatio)
                ]);
                break;
            }
        }
        return newPointGroup;
    }
    getPointGroupStringMissing(pointGroupString, pointGroupNo) {
        const pointGroupNum = this.countOccurrences(pointGroupString, 'M');
        let pointGroupMissingNum = 0;
        let pointGroupMissingString = '';
        if (pointGroupNo - pointGroupNum > 1) {
            pointGroupMissingNum = pointGroupNo - pointGroupNum - 1;
        }
        for (let i = 0; i < pointGroupMissingNum; i++) {
            pointGroupMissingString += 'M0,0';
        }
        return pointGroupMissingString;
    }
    drawLineToVolume(pointGroup, pointGroupNo, dAttribute, element, volume) {
        if (volume >= 0 && volume <= 100) {
            const length = this.getLineLength(pointGroup) / 100 * volume;
            const newPointGroup = this.changePointGroupAtLength(pointGroup, length);
            let workRange = this.getRangeOf(dAttribute, 'M', pointGroupNo);
            let lineString = '';
            for (let i = 0; i < newPointGroup.length; i++) {
                lineString += lineString == '' ? '' : 'L';
                lineString += `${newPointGroup[i][0]},${newPointGroup[i][1]}`;
            }
            if (workRange === null) {
                dAttribute = `${dAttribute}${this.getPointGroupStringMissing(dAttribute, pointGroupNo)}M${lineString}`;
            }
            else {
                dAttribute = dAttribute.substring(0, workRange[0]) + lineString + dAttribute.substring(workRange[1], dAttribute.length);
            }
            element.setAttribute('d', dAttribute);
            return dAttribute;
        }
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGluZS1zdmctbW90aW9uLmpzIiwic291cmNlUm9vdCI6Im5nOi8vc3ZnLW1vdGlvbi8iLCJzb3VyY2VzIjpbImxpbmUtc3ZnLW1vdGlvbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxNQUFNLE9BQU8sYUFBYTtJQUd6QjtRQUZVLG1CQUFjLEdBQWEsRUFBRSxDQUFDO0lBRXhCLENBQUM7SUFFVixpQkFBaUI7UUFDdkIsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDO0lBQzVCLENBQUM7SUFFTSxxQkFBcUIsQ0FBQyxVQUFrQixFQUFFLE9BQW9CLEVBQUUsTUFBYyxFQUFFLFVBQW1CLEtBQUs7UUFDOUcsTUFBTSxXQUFXLEdBQWlCLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUV2RSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM1QyxJQUFJLE9BQU8sRUFBRTtnQkFDWixXQUFXLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO2FBQzFDO1lBRUQsVUFBVSxHQUFHLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1NBQ3ZGO1FBRUQsT0FBTyxVQUFVLENBQUM7SUFDbkIsQ0FBQztJQUVNLGdCQUFnQixDQUN0QixVQUFrQixFQUNsQixPQUFvQixFQUNwQixFQUNDLElBQUksRUFBRSxJQUFJLEdBQUcsSUFBSSxFQUNqQixJQUFJLEVBQUUsSUFBSSxHQUFHLEdBQUcsRUFDaEIsVUFBVSxFQUFFLFVBQVUsR0FBRyxLQUFLLEVBQzlCLElBQUksRUFBRSxJQUFJLEdBQUcsUUFBUSxFQUNyQixFQUNELGlCQUE2QixJQUFJO1FBR2pDLElBQUksR0FB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LEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFO2dCQUM5QyxVQUFVLElBQUksVUFBVSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7Z0JBQzFDLFVBQVUsSUFBSSxHQUFHLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQzthQUM5RDtZQUVELElBQUksU0FBUyxLQUFLLElBQUksRUFBRTtnQkFDdkIsVUFBVSxHQUFHLEdBQUcsVUFBVSxHQUFHLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxVQUFVLEVBQUUsWUFBWSxDQUFDLElBQUksVUFBVSxFQUFFLENBQUM7YUFDdkc7aUJBQU07Z0JBQ04sVUFBVSxHQUFHLFVBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLFVBQVUsR0FBRyxVQUFVLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDeEg7WUFFRCxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxVQUFVLENBQUMsQ0FBQztZQUN0QyxPQUFPLFVBQVUsQ0FBQztTQUNsQjtJQUNGLENBQUM7Q0FDRCIsInNvdXJjZXNDb250ZW50IjpbIlxuZXhwb3J0IGNsYXNzIExpbmVTdmdNb3Rpb24ge1xuXHRwcm90ZWN0ZWQgbGluZUFuaW1hdGlvbnM6IHN5bWJvbFtdID0gW107XG5cblx0Y29uc3RydWN0b3IoKSB7IH1cblxuXHRwdWJsaWMgZ2V0TGluZUFuaW1hdGlvbnMoKTogc3ltYm9sW10ge1xuXHRcdHJldHVybiB0aGlzLmxpbmVBbmltYXRpb25zO1xuXHR9XG5cblx0cHVibGljIGRyYXdMaW5lR3JvdXBUb1ZvbHVtZShkQXR0cmlidXRlOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCB2b2x1bWU6IG51bWJlciwgcmV2ZXJzZTogYm9vbGVhbiA9IGZhbHNlKTogc3RyaW5nIHtcblx0XHRjb25zdCBwb2ludEdyb3VwczogbnVtYmVyW11bXVtdID0gdGhpcy5nZW5lcmF0ZVBvaW50R3JvdXBzKGRBdHRyaWJ1dGUpO1xuXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBwb2ludEdyb3Vwcy5sZW5ndGg7IGkrKykge1xuXHRcdFx0aWYgKHJldmVyc2UpIHtcblx0XHRcdFx0cG9pbnRHcm91cHNbaV0gPSBwb2ludEdyb3Vwc1tpXS5yZXZlcnNlKCk7XG5cdFx0XHR9XG5cblx0XHRcdGRBdHRyaWJ1dGUgPSB0aGlzLmRyYXdMaW5lVG9Wb2x1bWUocG9pbnRHcm91cHNbaV0sIGkgKyAxLCBkQXR0cmlidXRlLCBlbGVtZW50LCB2b2x1bWUpO1xuXHRcdH1cblxuXHRcdHJldHVybiBkQXR0cmlidXRlO1xuXHR9XG5cblx0cHVibGljIGFuaW1hdGVMaW5lR3JvdXAoXG5cdFx0ZEF0dHJpYnV0ZTogc3RyaW5nLFxuXHRcdGVsZW1lbnQ6IEhUTUxFbGVtZW50LFxuXHRcdHtcblx0XHRcdHRpbWU6IHRpbWUgPSAxMDAwLFxuXHRcdFx0c3RlcDogc3RlcCA9IDEwMCxcblx0XHRcdGlzUmV2ZXJzZWQ6IGlzUmV2ZXJzZWQgPSBmYWxzZSxcblx0XHRcdG1vZGU6IG1vZGUgPSAnRVhQQU5EJ1xuXHRcdH0sXG5cdFx0ZmluaXNoQ2FsbGJhY2s6ICgpID0+IHZvaWQgPSBudWxsXG5cdCk6IHN5bWJvbCB7XG5cdFx0XG5cdFx0bW9kZSA9IG1vZGUudG9VcHBlckNhc2UoKTtcblx0XHRjb25zdCBsaW5lQW5pbWF0aW9uSWQ6IHN5bWJvbCA9IHRoaXMucHVzaE5ld0xpbmVBbmltYXRpb24oKTtcblxuXHRcdHN3aXRjaCAobW9kZSkge1xuXHRcdFx0Y2FzZSAnQ09MTEFQU0UnOlxuXHRcdFx0XHR0aGlzLmhhbmRsZUFuaW1hdGlvbkNvbGxhcHNlTW9kZShsaW5lQW5pbWF0aW9uSWQsIGRBdHRyaWJ1dGUsIGVsZW1lbnQsIHN0ZXAsIHRpbWUsIGlzUmV2ZXJzZWQsIGZpbmlzaENhbGxiYWNrKTtcblx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdGNhc2UgJ0xPQURJTkcnOlxuXHRcdFx0XHR0aGlzLmhhbmRsZUFuaW1hdGlvbkxvYWRpbmdNb2RlKGxpbmVBbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgdGltZSwgaXNSZXZlcnNlZCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlICdMT0FESU5HMic6XG5cdFx0XHRcdHRoaXMuaGFuZGxlQW5pbWF0aW9uTG9hZGluZzJNb2RlKGxpbmVBbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgdGltZSwgaXNSZXZlcnNlZCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlICdMT0FESU5HMyc6XG5cdFx0XHRcdHRoaXMuaGFuZGxlQW5pbWF0aW9uTG9hZGluZzNNb2RlKGxpbmVBbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgdGltZSwgaXNSZXZlcnNlZCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRjYXNlICdMT0FESU5HNCc6XG5cdFx0XHRcdHRoaXMuaGFuZGxlQW5pbWF0aW9uTG9hZGluZzRNb2RlKGxpbmVBbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgdGltZSwgaXNSZXZlcnNlZCk7XG5cdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHR0aGlzLmhhbmRsZUFuaW1hdGlvbk5vcm1hbE1vZGUobGluZUFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCB0aW1lLCBpc1JldmVyc2VkLCBmaW5pc2hDYWxsYmFjayk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblxuXHRcdHJldHVybiBsaW5lQW5pbWF0aW9uSWQ7XG5cdH1cblxuXG5cdHByb3RlY3RlZCBjYWxjTW90aW9uVHJpZ29ub21ldHJpY0VxdWF0aW9ucyh4OiBudW1iZXIpOiBudW1iZXIge1xuXHRcdHJldHVybiBNYXRoLnNpbigoTWF0aC5QSSAvIDIpICogTWF0aC5wb3coeCwgNikpO1xuXHR9XG5cblxuXHRwcm90ZWN0ZWQgZ2VuZXJhdGVMaW5lQW5pbWF0aW9uSWQoKTogc3ltYm9sIHtcblx0XHRyZXR1cm4gU3ltYm9sKCk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgcmVtb3ZlTGluZUFuaW1hdGlvbihpZDogc3ltYm9sKSB7XG5cdFx0Y29uc3QgaW5kZXg6IG51bWJlciA9IHRoaXMubGluZUFuaW1hdGlvbnMuaW5kZXhPZihpZCk7XG5cdFx0aWYgKGluZGV4ICE9PSAtMSkge1xuXHRcdFx0dGhpcy5saW5lQW5pbWF0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xuXHRcdH1cblx0fVxuXG5cdHByb3RlY3RlZCBleGlzdExpbmVBbmltYXRpb24oaWQ6IHN5bWJvbCkge1xuXHRcdHJldHVybiB0aGlzLmxpbmVBbmltYXRpb25zLmluZGV4T2YoaWQpICE9PSAtMTtcblx0fVxuXG5cdHByb3RlY3RlZCBwdXNoTmV3TGluZUFuaW1hdGlvbigpOiBzeW1ib2wge1xuXHRcdGNvbnN0IGtleTogc3ltYm9sID0gdGhpcy5nZW5lcmF0ZUxpbmVBbmltYXRpb25JZCgpO1xuXG5cdFx0dGhpcy5saW5lQW5pbWF0aW9ucy5wdXNoKGtleSk7XG5cblx0XHRyZXR1cm4ga2V5O1xuXHR9XG5cblx0cHJvdGVjdGVkIGhhbmRsZUFuaW1hdGlvbkxvYWRpbmdNb2RlKGFuaW1hdGlvbklkOiBzeW1ib2wsIGRBdHRyaWJ1dGU6IHN0cmluZywgZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0ZXA6IG51bWJlciwgdGltZTogbnVtYmVyLCBpc1JldmVyc2VkOiBib29sZWFuKSB7XG5cdFx0Y29uc3Qgc3BlZWQ6IG51bWJlciA9IHRpbWUgLyBzdGVwO1xuXHRcdHRoaXMucmVjdXJzaXZlQW5pbWF0aW9uTGluZUdyb3VwKGFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCBzcGVlZCwgMCwgdHJ1ZSwgaXNSZXZlcnNlZCwgKCkgPT4ge1xuXHRcdFx0dGhpcy5yZWN1cnNpdmVBbmltYXRpb25MaW5lR3JvdXAoYW5pbWF0aW9uSWQsIGRBdHRyaWJ1dGUsIGVsZW1lbnQsIHN0ZXAsIHNwZWVkLCAxMDAsIGZhbHNlLCAhaXNSZXZlcnNlZCwgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmhhbmRsZUFuaW1hdGlvbkxvYWRpbmdNb2RlKGFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCB0aW1lLCBpc1JldmVyc2VkKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJvdGVjdGVkIGhhbmRsZUFuaW1hdGlvbkxvYWRpbmcyTW9kZShhbmltYXRpb25JZDogc3ltYm9sLCBkQXR0cmlidXRlOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdGVwOiBudW1iZXIsIHRpbWU6IG51bWJlciwgaXNSZXZlcnNlZDogYm9vbGVhbikge1xuXHRcdGNvbnN0IHNwZWVkOiBudW1iZXIgPSB0aW1lIC8gc3RlcDtcblx0XHR0aGlzLnJlY3Vyc2l2ZUFuaW1hdGlvbkxpbmVHcm91cChhbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgc3BlZWQsIDAsIHRydWUsIGlzUmV2ZXJzZWQsICgpID0+IHtcblx0XHRcdHRoaXMucmVjdXJzaXZlQW5pbWF0aW9uTGluZUdyb3VwKGFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCBzcGVlZCwgMTAwLCBmYWxzZSwgaXNSZXZlcnNlZCwgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmhhbmRsZUFuaW1hdGlvbkxvYWRpbmcyTW9kZShhbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgdGltZSwgaXNSZXZlcnNlZCk7XG5cdFx0XHR9KTtcblx0XHR9KTtcblx0fVxuXG5cdHByb3RlY3RlZCBoYW5kbGVBbmltYXRpb25Mb2FkaW5nM01vZGUoYW5pbWF0aW9uSWQ6IHN5bWJvbCwgZEF0dHJpYnV0ZTogc3RyaW5nLCBlbGVtZW50OiBIVE1MRWxlbWVudCwgc3RlcDogbnVtYmVyLCB0aW1lOiBudW1iZXIsIGlzUmV2ZXJzZWQ6IGJvb2xlYW4pIHtcblx0XHRjb25zdCBzcGVlZDogbnVtYmVyID0gdGltZSAvIHN0ZXA7XG5cdFx0dGhpcy5yZWN1cnNpdmVBbmltYXRpb25MaW5lR3JvdXAoYW5pbWF0aW9uSWQsIGRBdHRyaWJ1dGUsIGVsZW1lbnQsIHN0ZXAsIHNwZWVkLCAxMDAsIGZhbHNlLCAhaXNSZXZlcnNlZCwgKCkgPT4ge1xuXHRcdFx0dGhpcy5yZWN1cnNpdmVBbmltYXRpb25MaW5lR3JvdXAoYW5pbWF0aW9uSWQsIGRBdHRyaWJ1dGUsIGVsZW1lbnQsIHN0ZXAsIHNwZWVkLCAwLCB0cnVlLCBpc1JldmVyc2VkLCAoKSA9PiB7XG5cdFx0XHRcdHRoaXMuaGFuZGxlQW5pbWF0aW9uTG9hZGluZzNNb2RlKGFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCB0aW1lLCBpc1JldmVyc2VkKTtcblx0XHRcdH0pO1xuXHRcdH0pO1xuXHR9XG5cblx0cHJvdGVjdGVkIGhhbmRsZUFuaW1hdGlvbkxvYWRpbmc0TW9kZShhbmltYXRpb25JZDogc3ltYm9sLCBkQXR0cmlidXRlOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCBzdGVwOiBudW1iZXIsIHRpbWU6IG51bWJlciwgaXNSZXZlcnNlZDogYm9vbGVhbikge1xuXHRcdGNvbnN0IHNwZWVkOiBudW1iZXIgPSB0aW1lIC8gc3RlcDtcblx0XHR0aGlzLnJlY3Vyc2l2ZUFuaW1hdGlvbkxpbmVHcm91cChhbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgc3BlZWQsIDEwMCwgZmFsc2UsIGlzUmV2ZXJzZWQsICgpID0+IHtcblx0XHRcdHRoaXMucmVjdXJzaXZlQW5pbWF0aW9uTGluZUdyb3VwKGFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCBzcGVlZCwgMCwgdHJ1ZSwgIWlzUmV2ZXJzZWQsICgpID0+IHtcblx0XHRcdFx0dGhpcy5oYW5kbGVBbmltYXRpb25Mb2FkaW5nNE1vZGUoYW5pbWF0aW9uSWQsIGRBdHRyaWJ1dGUsIGVsZW1lbnQsIHN0ZXAsIHRpbWUsIGlzUmV2ZXJzZWQpO1xuXHRcdFx0fSk7XG5cdFx0fSk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgaGFuZGxlQW5pbWF0aW9uQ29sbGFwc2VNb2RlKGFuaW1hdGlvbklkOiBzeW1ib2wsIGRBdHRyaWJ1dGU6IHN0cmluZywgZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0ZXA6IG51bWJlciwgdGltZTogbnVtYmVyLCBpc1JldmVyc2VkOiBib29sZWFuLCBmaW5pc2hDYWxsYmFjaz86ICgpID0+IHZvaWQpIHtcblx0XHR0aGlzLnJlY3Vyc2l2ZUFuaW1hdGlvbkxpbmVHcm91cChhbmltYXRpb25JZCwgZEF0dHJpYnV0ZSwgZWxlbWVudCwgc3RlcCwgKHRpbWUgLyBzdGVwKSwgMTAwLCBmYWxzZSwgaXNSZXZlcnNlZCwgZmluaXNoQ2FsbGJhY2spO1xuXHR9XG5cblx0cHJvdGVjdGVkIGhhbmRsZUFuaW1hdGlvbk5vcm1hbE1vZGUoYW5pbWF0aW9uSWQ6IHN5bWJvbCwgZEF0dHJpYnV0ZTogc3RyaW5nLCBlbGVtZW50OiBIVE1MRWxlbWVudCwgc3RlcDogbnVtYmVyLCB0aW1lOiBudW1iZXIsIGlzUmV2ZXJzZWQ6IGJvb2xlYW4sIGZpbmlzaENhbGxiYWNrPzogKCkgPT4gdm9pZCkge1xuXHRcdHRoaXMucmVjdXJzaXZlQW5pbWF0aW9uTGluZUdyb3VwKGFuaW1hdGlvbklkLCBkQXR0cmlidXRlLCBlbGVtZW50LCBzdGVwLCAodGltZSAvIHN0ZXApLCAwLCB0cnVlLCBpc1JldmVyc2VkLCBmaW5pc2hDYWxsYmFjayk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgcmVjdXJzaXZlQW5pbWF0aW9uTGluZUdyb3VwKGFuaW1hdGlvbklkOiBzeW1ib2wsIGRBdHRyaWJ1dGU6IHN0cmluZywgZWxlbWVudDogSFRNTEVsZW1lbnQsIHN0ZXA6IG51bWJlciwgc3BlZWQ6IG51bWJlciwgY3VycmVudFN0ZXA6IG51bWJlciwgaXNFeHBhbmQsIGlzUmV2ZXJzZWQ6IGJvb2xlYW4sIGZpbmlzaENhbGxiYWNrPzogKCkgPT4gdm9pZCkge1xuXHRcdGlmICh0aGlzLmV4aXN0TGluZUFuaW1hdGlvbihhbmltYXRpb25JZCkpIHtcblx0XHRcdHRoaXMuZHJhd0xpbmVHcm91cFRvVm9sdW1lKGRBdHRyaWJ1dGUsIGVsZW1lbnQsIDEwMCAqIHRoaXMuY2FsY01vdGlvblRyaWdvbm9tZXRyaWNFcXVhdGlvbnMoY3VycmVudFN0ZXAgLyBzdGVwKSwgaXNSZXZlcnNlZCk7XG5cblx0XHRcdGlmIChcblx0XHRcdFx0KGlzRXhwYW5kICYmIGN1cnJlbnRTdGVwID09PSBzdGVwKSB8fFxuXHRcdFx0XHQoIWlzRXhwYW5kICYmIGN1cnJlbnRTdGVwID09PSAwKVxuXHRcdFx0KSB7XG5cdFx0XHRcdGlmIChmaW5pc2hDYWxsYmFjayAhPSBudWxsKSB7XG5cdFx0XHRcdFx0ZmluaXNoQ2FsbGJhY2soKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKGlzRXhwYW5kKSB7XG5cdFx0XHRcdFx0Y3VycmVudFN0ZXArKztcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjdXJyZW50U3RlcC0tO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0c2V0VGltZW91dChcblx0XHRcdFx0XHQoKSA9PiAodGhpcy5yZWN1cnNpdmVBbmltYXRpb25MaW5lR3JvdXAoYW5pbWF0aW9uSWQsIGRBdHRyaWJ1dGUsIGVsZW1lbnQsIHN0ZXAsIHNwZWVkLCBjdXJyZW50U3RlcCwgaXNFeHBhbmQsIGlzUmV2ZXJzZWQsIGZpbmlzaENhbGxiYWNrKSlcblx0XHRcdFx0XHQsIHNwZWVkXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0cHJvdGVjdGVkIGdlbmVyYXRlUG9pbnRHcm91cHMoZEF0dHJpYnV0ZTogc3RyaW5nKTogbnVsbCB8IG51bWJlcltdW11bXSB7XG5cdFx0Y29uc3QgcG9pbnRHcm91cFN0cmluZ3M6IHN0cmluZ1tdID0gZEF0dHJpYnV0ZS5zcGxpdChcIk1cIik7XG5cdFx0Y29uc3QgcG9pbnRHcm91cHM6IG51bWJlcltdW11bXSA9IFtdO1xuXG5cdFx0aWYgKHBvaW50R3JvdXBTdHJpbmdzWzBdID09PSBcIlwiKSB7XG5cdFx0XHRmb3IgKGxldCBpID0gMTsgaSA8IHBvaW50R3JvdXBTdHJpbmdzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGNvbnN0IHBvaW50U3RyaW5ncyA9IHBvaW50R3JvdXBTdHJpbmdzW2ldLnNwbGl0KFwiTFwiKTtcblxuXHRcdFx0XHRmb3IgKGxldCBqID0gMDsgaiA8IHBvaW50U3RyaW5ncy5sZW5ndGg7IGorKykge1xuXHRcdFx0XHRcdGNvbnN0IHBvaW50ID0gW1xuXHRcdFx0XHRcdFx0cGFyc2VGbG9hdChwb2ludFN0cmluZ3Nbal0uc3BsaXQoXCIsXCIpWzBdKSxcblx0XHRcdFx0XHRcdHBhcnNlRmxvYXQocG9pbnRTdHJpbmdzW2pdLnNwbGl0KFwiLFwiKVsxXSksXG5cdFx0XHRcdFx0XTtcblx0XHRcdFx0XHRpZiAocG9pbnRHcm91cHNbaSAtIDFdID09PSB1bmRlZmluZWQpIHtcblx0XHRcdFx0XHRcdHBvaW50R3JvdXBzW2kgLSAxXSA9IFtdO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdHBvaW50R3JvdXBzW2kgLSAxXVtwb2ludEdyb3Vwc1tpIC0gMV0ubGVuZ3RoXSA9IHBvaW50O1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGFsZXJ0KFwibm90IGZvdW5kIE1cIik7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHBvaW50R3JvdXBzLmxlbmd0aCA+IDAgPyBwb2ludEdyb3VwcyA6IG51bGw7XG5cdH1cblxuXHRwcm90ZWN0ZWQgY291bnRPY2N1cnJlbmNlcyh0ZXh0OiBzdHJpbmcsIHNlYXJjaDogc3RyaW5nKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gdGV4dC5zcGxpdChzZWFyY2gpLmxlbmd0aCAtIDE7XG5cdH1cblxuXHRwcm90ZWN0ZWQgZ2V0UmFuZ2VPZih0ZXh0OiBzdHJpbmcsIHNlYXJjaDogc3RyaW5nLCBubzogbnVtYmVyKTogbnVtYmVyW10gfCBudWxsIHtcblx0XHRpZiAodGhpcy5jb3VudE9jY3VycmVuY2VzKHRleHQsIHNlYXJjaCkgPj0gbm8pIHtcblx0XHRcdGxldCBzdGFydEluZGV4OiBudW1iZXIgPSAwO1xuXHRcdFx0bGV0IGVuZEluZGV4OiBudW1iZXIgPSAwO1xuXHRcdFx0bGV0IG46IG51bWJlciA9IDA7XG5cblx0XHRcdHdoaWxlIChuIDwgbm8pIHtcblx0XHRcdFx0c3RhcnRJbmRleCA9IHRleHQuaW5kZXhPZihzZWFyY2gsIHN0YXJ0SW5kZXgpICsgc2VhcmNoLmxlbmd0aDtcblx0XHRcdFx0bisrO1xuXHRcdFx0fVxuXG5cdFx0XHRlbmRJbmRleCA9ICh0ZXh0LmluZGV4T2Yoc2VhcmNoLCBzdGFydEluZGV4KSA9PT0gLTEpID8gdGV4dC5sZW5ndGggOiB0ZXh0LmluZGV4T2Yoc2VhcmNoLCBzdGFydEluZGV4KTtcblxuXHRcdFx0cmV0dXJuIFtcblx0XHRcdFx0c3RhcnRJbmRleCxcblx0XHRcdFx0ZW5kSW5kZXhcblx0XHRcdF07XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBudWxsO1xuXHRcdH1cblx0fVxuXG5cdHByb3RlY3RlZCBnZXRQb2ludHNEaXN0YW5jZShwb2ludDE6IG51bWJlcltdLCBwb2ludDI6IG51bWJlcltdKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gTWF0aC5zcXJ0KE1hdGgucG93KHBvaW50MlswXSAtIHBvaW50MVswXSwgMikgKyBNYXRoLnBvdyhwb2ludDJbMV0gLSBwb2ludDFbMV0sIDIpKTtcblx0fVxuXG5cdHByb3RlY3RlZCBnZXRMaW5lTGVuZ3RoKHBvaW50R3JvdXA6IG51bWJlcltdW10pOiBudW1iZXIge1xuXHRcdGxldCBsZW5ndGg6IG51bWJlciA9IDAuMDtcblxuXHRcdGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRHcm91cC5sZW5ndGg7IGkrKykge1xuXHRcdFx0bGVuZ3RoICs9IHRoaXMuZ2V0UG9pbnRzRGlzdGFuY2UocG9pbnRHcm91cFtpIC0gMV0sIHBvaW50R3JvdXBbaV0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBsZW5ndGg7XG5cdH1cblxuXHRwcm90ZWN0ZWQgcm91bmRQb2ludChwb2ludDogbnVtYmVyW10pOiBudW1iZXJbXSB7XG5cdFx0cG9pbnRbMF0gPSBNYXRoLnJvdW5kKChwb2ludFswXSArIE51bWJlci5FUFNJTE9OKSAqIDEwMDApIC8gMTAwMDtcblx0XHRwb2ludFsxXSA9IE1hdGgucm91bmQoKHBvaW50WzFdICsgTnVtYmVyLkVQU0lMT04pICogMTAwMCkgLyAxMDAwO1xuXG5cdFx0cmV0dXJuIHBvaW50O1xuXHR9XG5cblx0cHJvdGVjdGVkIGNoYW5nZVBvaW50R3JvdXBBdExlbmd0aChwb2ludEdyb3VwOiBudW1iZXJbXVtdLCBsZW5ndGg6IG51bWJlcik6IG51bWJlcltdW10ge1xuXHRcdGxldCBjdXJyZW50TGVuZ3RoOiBudW1iZXIgPSAwO1xuXHRcdGNvbnN0IG5ld1BvaW50R3JvdXA6IG51bWJlcltdW10gPSBbcG9pbnRHcm91cFswXV07XG5cblx0XHRmb3IgKGxldCBpID0gMTsgaSA8IHBvaW50R3JvdXAubGVuZ3RoOyBpKyspIHtcblx0XHRcdGNvbnN0IGN1cnJlbnRMaW5lTGVuZ3RoID0gdGhpcy5nZXRQb2ludHNEaXN0YW5jZShwb2ludEdyb3VwW2kgLSAxXSwgcG9pbnRHcm91cFtpXSk7XG5cdFx0XHRjdXJyZW50TGVuZ3RoICs9IGN1cnJlbnRMaW5lTGVuZ3RoO1xuXHRcdFx0bmV3UG9pbnRHcm91cC5wdXNoKHBvaW50R3JvdXBbaV0pO1xuXG5cdFx0XHRpZiAoY3VycmVudExlbmd0aCA+PSBsZW5ndGgpIHtcblx0XHRcdFx0Y29uc3QgbmV3TGluZUxlbmd0aCA9IGxlbmd0aCArIGN1cnJlbnRMaW5lTGVuZ3RoIC0gY3VycmVudExlbmd0aDtcblx0XHRcdFx0Y29uc3QgYmV0d2Vlbkxlbmd0aFJhdGlvID0gbmV3TGluZUxlbmd0aCAvIGN1cnJlbnRMaW5lTGVuZ3RoO1xuXG5cdFx0XHRcdG5ld1BvaW50R3JvdXBbaV0gPSB0aGlzLnJvdW5kUG9pbnQoW1xuXHRcdFx0XHRcdHBvaW50R3JvdXBbaSAtIDFdWzBdICsgKChwb2ludEdyb3VwW2ldWzBdIC0gcG9pbnRHcm91cFtpIC0gMV1bMF0pICogYmV0d2Vlbkxlbmd0aFJhdGlvKSxcblx0XHRcdFx0XHRwb2ludEdyb3VwW2kgLSAxXVsxXSArICgocG9pbnRHcm91cFtpXVsxXSAtIHBvaW50R3JvdXBbaSAtIDFdWzFdKSAqIGJldHdlZW5MZW5ndGhSYXRpbylcblx0XHRcdFx0XSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBuZXdQb2ludEdyb3VwO1xuXHR9XG5cblx0cHJvdGVjdGVkIGdldFBvaW50R3JvdXBTdHJpbmdNaXNzaW5nKHBvaW50R3JvdXBTdHJpbmc6IHN0cmluZywgcG9pbnRHcm91cE5vOiBudW1iZXIpOiBzdHJpbmcge1xuXHRcdGNvbnN0IHBvaW50R3JvdXBOdW06IG51bWJlciA9IHRoaXMuY291bnRPY2N1cnJlbmNlcyhwb2ludEdyb3VwU3RyaW5nLCAnTScpO1xuXHRcdGxldCBwb2ludEdyb3VwTWlzc2luZ051bTogbnVtYmVyID0gMDtcblx0XHRsZXQgcG9pbnRHcm91cE1pc3NpbmdTdHJpbmc6IHN0cmluZyA9ICcnO1xuXG5cdFx0aWYgKHBvaW50R3JvdXBObyAtIHBvaW50R3JvdXBOdW0gPiAxKSB7XG5cdFx0XHRwb2ludEdyb3VwTWlzc2luZ051bSA9IHBvaW50R3JvdXBObyAtIHBvaW50R3JvdXBOdW0gLSAxO1xuXHRcdH1cblxuXHRcdGZvciAobGV0IGkgPSAwOyBpIDwgcG9pbnRHcm91cE1pc3NpbmdOdW07IGkrKykge1xuXHRcdFx0cG9pbnRHcm91cE1pc3NpbmdTdHJpbmcgKz0gJ00wLDAnO1xuXHRcdH1cblxuXHRcdHJldHVybiBwb2ludEdyb3VwTWlzc2luZ1N0cmluZztcblx0fVxuXG5cdHByb3RlY3RlZCBkcmF3TGluZVRvVm9sdW1lKHBvaW50R3JvdXA6IG51bWJlcltdW10sIHBvaW50R3JvdXBObzogbnVtYmVyLCBkQXR0cmlidXRlOiBzdHJpbmcsIGVsZW1lbnQ6IEhUTUxFbGVtZW50LCB2b2x1bWU6IG51bWJlcik6IHN0cmluZyB7XG5cdFx0aWYgKHZvbHVtZSA+PSAwICYmIHZvbHVtZSA8PSAxMDApIHtcblx0XHRcdGNvbnN0IGxlbmd0aDogbnVtYmVyID0gdGhpcy5nZXRMaW5lTGVuZ3RoKHBvaW50R3JvdXApIC8gMTAwICogdm9sdW1lO1xuXHRcdFx0Y29uc3QgbmV3UG9pbnRHcm91cDogbnVtYmVyW11bXSA9IHRoaXMuY2hhbmdlUG9pbnRHcm91cEF0TGVuZ3RoKHBvaW50R3JvdXAsIGxlbmd0aCk7XG5cdFx0XHRsZXQgd29ya1JhbmdlOiBudW1iZXJbXSA9IHRoaXMuZ2V0UmFuZ2VPZihkQXR0cmlidXRlLCAnTScsIHBvaW50R3JvdXBObyk7XG5cdFx0XHRsZXQgbGluZVN0cmluZzogc3RyaW5nID0gJyc7XG5cblx0XHRcdGZvciAobGV0IGkgPSAwOyBpIDwgbmV3UG9pbnRHcm91cC5sZW5ndGg7IGkrKykge1xuXHRcdFx0XHRsaW5lU3RyaW5nICs9IGxpbmVTdHJpbmcgPT0gJycgPyAnJyA6ICdMJztcblx0XHRcdFx0bGluZVN0cmluZyArPSBgJHtuZXdQb2ludEdyb3VwW2ldWzBdfSwke25ld1BvaW50R3JvdXBbaV1bMV19YDtcblx0XHRcdH1cblxuXHRcdFx0aWYgKHdvcmtSYW5nZSA9PT0gbnVsbCkge1xuXHRcdFx0XHRkQXR0cmlidXRlID0gYCR7ZEF0dHJpYnV0ZX0ke3RoaXMuZ2V0UG9pbnRHcm91cFN0cmluZ01pc3NpbmcoZEF0dHJpYnV0ZSwgcG9pbnRHcm91cE5vKX1NJHtsaW5lU3RyaW5nfWA7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRkQXR0cmlidXRlID0gZEF0dHJpYnV0ZS5zdWJzdHJpbmcoMCwgd29ya1JhbmdlWzBdKSArIGxpbmVTdHJpbmcgKyBkQXR0cmlidXRlLnN1YnN0cmluZyh3b3JrUmFuZ2VbMV0sIGRBdHRyaWJ1dGUubGVuZ3RoKTtcblx0XHRcdH1cblxuXHRcdFx0ZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2QnLCBkQXR0cmlidXRlKTtcblx0XHRcdHJldHVybiBkQXR0cmlidXRlO1xuXHRcdH1cblx0fVxufVxuIl19